function html_encode(e){var t="";return 0==e.length?"":(t=e.replace(/>/g,"&gt;"),t=t.replace(/</g,"&lt;"),t=t.replace(/ /g,"&nbsp;"),t=t.replace(/\'/g,"&#39;"),t=t.replace(/\"/g,"&quot;"),t=t.replace(/\n/g,"<br>"))}function html_decode(e){var t="";return 0==e.length?"":(t=e.replace(/&gt;/g,">"),t=t.replace(/&lt;/g,"<"),t=t.replace(/&nbsp;/g," "),t=t.replace(/&#39;/g,"'"),t=t.replace(/&quot;/g,'"'),t=t.replace(/<br>/g,"\n"))}$(document).ready(function(){function e(){t.empty(),console.log("refreshNews"),$.ajax({type:"get",url:"/admin/getnews",datatype:"json",data:{newstype:null},success:function(e){e.forEach(function(e){var n=$("<td>").html(e.Id),s=$("<td>").html(e.newstype),a=$("<td>").html(e.newstitle),l=$("<td>").html(e.newsimg),r=$("<td>").html(e.newssrc),d=$("<td>").html(e.newstime),o=$("<td>"),c=$("<button>").addClass("btn btn-primary btn-xs").html("修改"),i=$("<button>").addClass("btn btn-danger btn-xs").html("删除");o.append(c,i);var m=$("<tr>");m.append(n,s,a,l,r,d,o),t.append(m)})}})}var t=$("#newstable tbody");e(),$("#btnsubmit").click(function(t){if(t.preventDefault(),""===$("#newstitle").val()||""===$("#newsimg").val()||""===$("#newssrc").val()||""===$("#newstime").val())""===$("#newstitle").val()?$("#newstitle").parent().addClass("has-error"):$("#newstitle").parent().removeClass("has-error"),""===$("#newsimg").val()?$("#newsimg").parent().addClass("has-error"):$("#newsimg").parent().removeClass("has-error"),""===$("#newssrc").val()?$("#newssrc").parent().addClass("has-error"):$("#newssrc").parent().removeClass("has-error"),""===$("#newstime").val()?$("#newstime").parent().addClass("has-error"):$("#newstime").parent().removeClass("has-error"),""===$("#newstype").val()?$("#newstype").parent().addClass("has-error"):$("#newstype").parent().removeClass("has-error");else{var n={newstitle:html_encode($("#newstitle").val()),newstype:html_encode($("#newstype").val()),newsimg:html_encode($("#newsimg").val()),newstime:html_encode($("#newstime").val()),newssrc:html_encode($("#newssrc").val())};console.log(n),$.ajax({url:"/admin/insert",type:"post",data:n,datatype:"json",success:function(){$("#newstitle").val(""),$("#newstype").val(""),$("#newsimg").val(""),$("#newstime").val(""),$("#newssrc").val(""),e()},error:function(){console.log("请求失败")}})}});var n=null;t.on("click",".btn-danger",function(){$("#deleteModal").modal("show"),n=$(this).parent().prevAll().eq(5).html(),console.log("要删除的id"+n)}),$("#deleteModal #confirmDelete").click(function(){n&&$.ajax({url:"/admin/delete",type:"post",data:{newsid:n},success:function(){$("#deleteModal").modal("hide"),e()}})});var s=null;t.on("click",".btn-primary",function(){$("#updateModal").modal("show"),s=$(this).parent().prevAll().eq(5).html(),$.ajax({url:"/admin/curnews",type:"get",data:{newsid:s},success:function(e){$("#unewstitle").val(html_decode(e[0].newstitle)),$("#unewstype").val(html_decode(e[0].newstype)),$("#unewsimg").val(html_decode(e[0].newsimg)),$("#unewssrc").val(html_decode(e[0].newssrc));var t=html_decode(e[0].newstime.split("T")[0]);$("#unewstime").val(t)}})}),$("#updateModal #confirmUpdate").click(function(){$.ajax({url:"/admin/update",type:"post",data:{newstitle:html_encode($("#unewstitle").val()),newstype:html_encode($("#unewstype").val()),newsimg:html_encode($("#unewsimg").val()),newstime:html_encode($("#unewstime").val()),newssrc:html_encode($("#unewssrc").val()),id:s},success:function(){$("#updateModal").modal("hide"),e()}})})});